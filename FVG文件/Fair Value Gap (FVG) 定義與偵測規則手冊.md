# Fair Value Gap (FVG) 定義與偵測規則手冊

## 一、第一性原理解釋
在連續三根 K 線推進過程中，若價格瞬間跳過某價位區間，即產生 price-delivery imbalance（FVG）。市場傾向回到該區補貨 / 出貨，常形成支撐或阻力。

## 二、結構定義（以三根 K 為一組）
- **看多 FVG（Bullish）**  
  - 左 K 高點 `H₁`  
  - 中 K 為推升實體（大小不限）  
  - 右 K 低點 `L₃`  
  - 若 `H₁ < L₃` ⇒ 區間 `[H₁, L₃]` 為 FVG  

- **看空 FVG（Bearish）**  
  - 左 K 低點 `L₁`  
  - 中 K 為下跌實體（大小不限）  
  - 右 K 高點 `H₃`  
  - 若 `L₁ > H₃` ⇒ 區間 `[H₃, L₁]` 為 FVG  

### 跳空型 FVG
- **向上跳空**：`Oₙ > Hₙ₋₁` → 區間 `[Hₙ₋₁, Oₙ]`
- **向下跳空**：`Oₙ < Lₙ₋₁` → 區間 `[Oₙ, Lₙ₋₁]`  
  （需同向實體：gap-up 多頭；gap-down 空頭）

## 三、偵測與追蹤規則
| 編號 | 規則 | 說明 |
|-----|------|------|
| **R1** | 滿足三根結構或跳空即標示 FVG | 基本定義 |
| **R2** | **壽命 40 根**：若 40 根內未被實體補滿 → `expired` | 限定有效期 |
| **R3** | **填補**：僅當某根 K 的實體 `[min(O,C), max(O,C)]` 完全覆蓋 FVG 區間，才算回補；影線不算 | wick 排除 |
| **R4** | **合併**：相鄰/重疊的同向 FVG 可合併成一區 | 視覺簡化 |
| **R5** | **多級別允許並存**：不同時間框架的 FVG 可同時存在，即使方向相反；由交易者自行判讀 | 去除優先序 |

> 備註：方向連續性設定為「左 K 與中 K 同色」；第三根顏色不拘。
