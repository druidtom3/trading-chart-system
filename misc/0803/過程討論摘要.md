三、過程討論摘要
專案演進歷程

初始需求釐清（Phase 0）

確認「開盤前五分鐘」指美股現貨開盤，非期貨
確立使用 Lightweight Charts 而非完整 TradingView
決定採用分階段開發策略


第一階段開發（Phase 1）

實現基礎資料載入與顯示
從下拉選單改為分頁式設計
解決 400 根 K 線填滿畫面問題
實現資料快取機制


第二階段開發（Phase 2）

實現基於 M1 的動態 K 線生成
解決分頁切換時的資料連續性問題
處理跨日交易的時間問題
優化播放效能



關鍵設計決策

分頁 vs 下拉選單

決定採用類似瀏覽器分頁的設計
提供更直觀的視覺體驗


播放架構

統一使用 M1 資料作為基礎
即時聚合生成其他時間刻度
所有分頁共享同一播放時鐘


資料管理

預載所有時間刻度資料
結合歷史資料與即時聚合資料
使用 Map 結構避免重複



四、修正摘要
主要問題與解決方案

K 線數量不足問題

問題：H1/H4 只顯示幾根 K 線
解決：修改資料載入邏輯，回溯歷史資料而非只取當日


播放時切換分頁顯示錯誤

問題：H1 分頁顯示 M1 K 線
解決：實現動態 K 線聚合器（CandleAggregator）


M1 切換回來時間不連續

問題：從 21:25 跳到 23:19
解決：統一所有時間刻度的資料合併邏輯


H1 K 線跳空問題

問題：H1 顯示有跳空但實際資料連續
解決：改進時間對齊邏輯，使用 Map 結構合併資料


跨日播放停止問題

問題：M1 播放到 23:59 停止
解決：修改資料查詢邏輯，支援跨日資料



五、專案分析與建議
優勢

模組化設計：前後端分離，易於維護
即時聚合：創新的動態 K 線生成機制
使用者體驗：流暢的分頁切換和播放控制

改進空間

效能優化：大量資料時可能有延遲
錯誤處理：需要更完善的異常處理
測試覆蓋：缺乏自動化測試

發展建議

短期：完善 H1 跳空問題，優化播放效能
中期：實作技術指標，加入成交量圖表
長期：AI 分析功能，多合約支援

六、正在進行或尚未穩定的部分
🔄 進行中

H1 K 線跳空修正

狀態：已提供修正方案，待測試
問題：時間對齊可能仍有邊界情況


VWAP 計算

狀態：目前使用簡化版（收盤價）
需要：實作正確的 VWAP 聚合演算法


D1 時區處理

狀態：簡化處理，可能不準確
需要：考慮交易日定義（紐約時間）



七、尚未開始的功能
根據原始需求文件：

技術指標庫（25+ 種）

RSI, MACD, MA, EMA, Bollinger Bands 等
參考 Jesse Framework 實作


FVG 檢測

Fair Value Gap 自動識別
多時間框架 FVG 顯示


成交量分析

Volume Profile
成交量柱狀圖


進階功能

Replay 模式（可調速播放）
資料匯出（CSV/JSON）
使用者標註系統


AI 功能

模式識別
預測分析
AI Agent 會議模式



八、建議的開發順序
立即修正（1-2 天）

驗證 H1 跳空修正
⏳ 優化播放效能
⏳ 完善錯誤處理

第三階段（1-2 週）

實作基礎技術指標（MA, EMA, RSI）
加入成交量柱狀圖
改進 VWAP 計算

第四階段（2-3 週）

完整技術指標庫
FVG 檢測功能
資料匯出功能

未來擴充

AI 相關功能
多合約支援
雲端部署