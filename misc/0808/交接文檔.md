# 交接文檔 - MNQ 標註系統開發
日期：2025-08-10

## 一、現有系統概況

### 技術棧
- **後端**：Python Flask + pandas
- **前端**：Vanilla JavaScript + Lightweight Charts
- **資料**：CSV 格式的 MNQ 期貨歷史數據（2019-2024）

### 已完成功能
1. **多時間框架顯示**：M1, M5, M15, H1, H4, D1, W1
2. **FVG 檢測與顯示**：
   - 後端檢測邏輯在 `src/backend/fvg_detector.py`
   - 支援單根/多根K線累積回補
   - 前端顯示為半透明矩形（有時間範圍限制）
3. **手動水平線工具**：可畫線、清除、跨時間框架保留
4. **播放功能**：模擬實時K線推進
5. **時區處理**：紐約/台北時間轉換，含夏令時

### 資料結構
```
trading_chart_system/
├── src/
│   ├── backend/       # Flask API
│   ├── frontend/      # 原始 JS 介面
│   └── utils/
├── data/             # CSV 歷史數據
├── FVG文件/          # FVG 規則文檔
└── misc/0808/        # 新需求文件
```

## 二、新專案需求摘要

### 核心目標
建立「黃金樣本庫」標註系統，用於訓練交易決策模型（非 LLM）

### 關鍵需求
1. **七個時間框架**的標註管理
2. **六種標註工具**：
   - S/R 水平線
   - FVG 缺口
   - AB=CD 四點工具（容忍誤差 13pt）
   - 0/50/100 回撤工具
   - Confirmation 下單點
   - SL/TP 風險管理
3. **狀態管理**：draft → confirmed → reopened
4. **主動學習**：模型提案 + 權重控制
5. **完整 JSON Schema**（130+ 行規格）

### 詳細需求文件
`misc/0808/0808新任務.txt`（166行完整規格）

## 三、技術決策建議

### 推薦架構
```
React + TypeScript + Vite
├── Lightweight Charts（圖表核心）
├── Zustand/Redux Toolkit（狀態管理）
├── React Hook Form + Zod（表單驗證）
├── TailwindCSS（樣式）
└── json-server（開發階段 mock API）
```

### 可重用資產
1. **FVG 檢測邏輯**：`src/backend/fvg_detector.py` 的演算法
2. **時區處理**：`src/backend/time_utils.py`
3. **CSV 資料**：`data/` 目錄下的所有檔案
4. **FVG 規則文檔**：`FVG文件/` 的定義

## 四、開發優先級建議

### Phase 1 - 基礎（1-2週）
- [ ] React 專案架構
- [ ] 七個 TF 分頁切換
- [ ] 基本圖表顯示
- [ ] S/R 水平線工具

### Phase 2 - 核心標註（2-3週）
- [ ] FVG 工具（重用現有邏輯）
- [ ] JSON 資料結構
- [ ] 表單 ↔ 圖表同步
- [ ] 儲存/載入功能

### Phase 3 - 進階工具（3-4週）
- [ ] AB=CD 四點工具
- [ ] 0/50/100 回撤
- [ ] Confirmation 系統
- [ ] SL/TP 管理

### Phase 4 - 流程完善（2週）
- [ ] Confirm/Lock/Reopen 狀態機
- [ ] 主動學習介面
- [ ] 匯出/匯入功能
- [ ] 熱鍵系統

## 五、關鍵技術挑戰

1. **AB=CD 容忍度計算**
   - 需要實現 13pt 容忍誤差
   - within_tolerance 自動判定

2. **跨 TF 投影顯示**
   - 資料歸屬於建立時的 TF
   - 但可投影顯示到其他 TF

3. **性能要求**
   - 60fps 渲染目標
   - 大量水平線不掉幀

4. **複雜狀態管理**
   - 7 TF × 6 工具 × 版本控制
   - 即時同步三處：圖表、表單、JSON

## 六、在新 Session 開始時

請說明：
```
我要開發一個 React 的交易標註系統。
需求文件在：C:\Users\druid\autogen-project\trading_chart_system\misc\0808\0808新任務.txt
現有系統在：C:\Users\druid\autogen-project\trading_chart_system\

請先閱讀需求文件，然後開始建立 React 專案架構。
```

## 七、注意事項

1. **檔案編碼**：確保 UTF-8（繁體中文介面）
2. **價位對齊**：所有價格四捨五入到 0.25
3. **時間格式**：ISO8601 + 台北時區 (+08:00)
4. **權重限制**：model_suggest ≤ 0.6，human_seed = 1.0

---

祝開發順利！如有問題可參考原始對話記錄。