çœ‹äº†ä½ çš„ç¨‹å¼ç¢¼ï¼Œæˆ‘ç™¼ç¾ä½ å·²ç¶“æ”¹å–„äº†ä¸€äº›ä¸»è¦å•é¡Œï¼Œç‰¹åˆ¥æ˜¯ï¼š
âœ… å·²æ”¹å–„çš„éƒ¨åˆ†ï¼š

Kç·šæ•¸é‡é™åˆ¶å·²çµ±ä¸€ä½¿ç”¨ DEFAULT_CANDLE_COUNT é…ç½®
ä½¿ç”¨äº† FVGDetectorSimple ä½œç‚ºä¸»è¦æª¢æ¸¬å™¨
æ™‚é–“æˆ³è™•ç†å·²æ¨™æº–åŒ–ï¼ˆæœ‰å°ˆé–€çš„ time_utils.py å’Œ timestamp-utils.jsï¼‰

ä½†ä»æœ‰ä¸€äº›æŠ€è¡“å‚µéœ€è¦è™•ç†ï¼š
ğŸ”´ ä¸»è¦å•é¡Œå’Œå…·é«”å»ºè­°
1. FVGæ¸²æŸ“å™¨ç‰ˆæœ¬éå¤šå•é¡Œ
å•é¡Œè­‰æ“šï¼š

index-v2.html ç¬¬882-887è¡Œè¼‰å…¥äº†6å€‹ä¸åŒçš„FVGæ¸²æŸ“å™¨
chart-manager.js ç¬¬306-337è¡Œæœ‰è¤‡é›œçš„æ¸²æŸ“å™¨é¸æ“‡é‚è¼¯

å…·é«”ä¿®æ”¹å»ºè­°ï¼š
javascript// chart-manager.js - ç°¡åŒ–ç‚ºåªä½¿ç”¨ä¸€å€‹æ¸²æŸ“å™¨
initializeFVGRenderer() {
    try {
        console.log('ğŸ¨ åˆå§‹åŒ– FVG æ¸²æŸ“å™¨');
        
        // åªä½¿ç”¨ Optimized ç‰ˆæœ¬ï¼Œç§»é™¤æ‰€æœ‰å…¶ä»–é¸æ“‡é‚è¼¯
        if (window.FVGRendererOptimized) {
            this.fvgRenderer = new FVGRendererOptimized(this.chart, this.candlestickSeries);
            console.log('âœ… FVGå„ªåŒ–æ¸²æŸ“å™¨åˆå§‹åŒ–æˆåŠŸ');
        } else {
            throw new Error('FVGæ¸²æŸ“å™¨æœªè¼‰å…¥');
        }
        
    } catch (error) {
        console.error('âŒ FVGæ¸²æŸ“å™¨åˆå§‹åŒ–å¤±æ•—:', error.message);
        this.fvgRenderer = null;
    }
}
index-v2.html ä¿®æ”¹ï¼š
javascript// åªè¼‰å…¥å¿…è¦çš„æ¸²æŸ“å™¨
const fvgRenderers = [
    'fvg-renderer-optimized.js',  // åªä¿ç•™é€™å€‹
    // ç§»é™¤å…¶ä»–5å€‹æ¸²æŸ“å™¨çš„è¼‰å…¥
];
2. å¾Œç«¯ç·©å­˜ç³»çµ±éæ–¼è¤‡é›œ
å•é¡Œè­‰æ“šï¼š

data_processor.py ç¬¬37-38è¡Œæœ‰å¤šå±¤ç·©å­˜
ç¬¬439è¡Œçš„ç·©å­˜keyåŒ…å«ç‰ˆæœ¬è™Ÿ

å…·é«”ä¿®æ”¹å»ºè­°ï¼š
python# data_processor.py - ç§»é™¤ä¸å¿…è¦çš„ç·©å­˜å±¤
class DataProcessor:
    def __init__(self):
        self.data_cache = {}  # åªä¿ç•™é€™å€‹åŸºæœ¬çš„æ•¸æ“šç·©å­˜
        # ç§»é™¤ä»¥ä¸‹ç·©å­˜ï¼š
        # self._response_cache = {}  # åˆªé™¤
        # self._processed_data_cache = {}  # åˆªé™¤
        
    def get_pre_market_data(self, target_date: date, timeframe: str = 'H4'):
        # ç§»é™¤ç·©å­˜é‚è¼¯ï¼Œç›´æ¥è™•ç†
        # cache_key = ...  # åˆªé™¤
        # cached_response = self._get_cached_response(cache_key)  # åˆªé™¤
        
        # ç›´æ¥è™•ç†æ•¸æ“š
        data = self._process_data(target_date, timeframe)
        return data
3. é€£çºŒæ€§æª¢æŸ¥å™¨ç‰ˆæœ¬é¸æ“‡
å•é¡Œè­‰æ“šï¼š

å­˜åœ¨å…©å€‹ç‰ˆæœ¬çš„æª¢æŸ¥å™¨
data_processor.py ç¬¬49-66è¡Œæœ‰è¤‡é›œçš„é¸æ“‡é‚è¼¯

å…·é«”ä¿®æ”¹å»ºè­°ï¼š
python# data_processor.py - çµ±ä¸€ä½¿ç”¨V2ç‰ˆæœ¬
class DataProcessor:
    def __init__(self):
        # ç›´æ¥ä½¿ç”¨V2ï¼Œç§»é™¤æ¢ä»¶åˆ¤æ–·
        from backend.candle_continuity_checker_v2 import CandleContinuityCheckerV2
        self.continuity_checker = CandleContinuityCheckerV2(
            optimization_mode='smart',  # å›ºå®šä½¿ç”¨smartæ¨¡å¼
            show_progress=False  # å¾Œç«¯ä¸éœ€è¦é€²åº¦æ¢
        )
        # ç§»é™¤ self.fast_startup ç›¸é—œé‚è¼¯
4. Consoleè¼¸å‡ºéå¤š
å…·é«”ä¿®æ”¹å»ºè­°ï¼š
å‰µå»ºä¸€å€‹çµ±ä¸€çš„æ—¥èªŒç®¡ç†å™¨ï¼š
javascript// utils/logger.js - æ–°å»ºæª”æ¡ˆ
class Logger {
    constructor() {
        this.debugMode = false;  // ç”Ÿç”¢ç’°å¢ƒè¨­ç‚ºfalse
    }
    
    log(...args) {
        if (this.debugMode) console.log(...args);
    }
    
    error(...args) {
        console.error(...args);  // éŒ¯èª¤ç¸½æ˜¯è¼¸å‡º
    }
    
    warn(...args) {
        if (this.debugMode) console.warn(...args);
    }
}

window.logger = new Logger();
ç„¶å¾Œå…¨å±€æ›¿æ›ï¼š

console.log â†’ logger.log
console.warn â†’ logger.warn

5. è¼‰å…¥ç³»çµ±éæ–¼è¤‡é›œ
å•é¡Œè­‰æ“šï¼š

index-v2.html æœ‰å¤šå€‹é€²åº¦æ¢ç³»çµ±
è¼‰å…¥é‚è¼¯åˆ†æ•£åœ¨å¤šè™•

å…·é«”ä¿®æ”¹å»ºè­°ï¼š
ç°¡åŒ–ç‚ºå–®ä¸€è¼‰å…¥ç®¡ç†å™¨ï¼š
javascript// loading-manager.js - æ–°å»ºæª”æ¡ˆ
class LoadingManager {
    constructor() {
        this.modules = [
            'config.js',
            'chart-manager.js',
            'data-manager.js',
            'fvg-renderer-optimized.js',  // åªè¼‰å…¥é€™ä¸€å€‹
            'script-v2.js'
        ];
    }
    
    async loadAll() {
        const total = this.modules.length;
        for (let i = 0; i < total; i++) {
            await this.loadScript(this.modules[i]);
            this.updateProgress((i + 1) / total * 100);
        }
    }
    
    updateProgress(percent) {
        // çµ±ä¸€çš„é€²åº¦æ›´æ–°
        document.getElementById('progress-fill').style.width = `${percent}%`;
    }
}
6. æ•¸æ“šé©—è­‰ä¸ä¸€è‡´
æ–°å¢å»ºè­°ï¼š
å‰µå»ºçµ±ä¸€çš„æ•¸æ“šé©—è­‰å™¨ï¼š
python# utils/data_validator.py - æ–°å»ºæª”æ¡ˆ
class DataValidator:
    @staticmethod
    def validate_candle_limit(data_length: int, timeframe: str, config_limit: int) -> int:
        """çµ±ä¸€çš„Kç·šæ•¸é‡é©—è­‰"""
        if data_length > config_limit:
            print(f"[{timeframe}] æ•¸æ“šé‡ {data_length} è¶…éé™åˆ¶ {config_limit}")
            return config_limit
        return data_length
    
    @staticmethod
    def validate_fvg_data(fvgs: list, max_count: int = 50) -> list:
        """çµ±ä¸€çš„FVGæ•¸é‡é©—è­‰"""
        if len(fvgs) > max_count:
            # æŒ‰é‡è¦æ€§æ’åºï¼Œåªä¿ç•™å‰Nå€‹
            return sorted(fvgs, key=lambda x: x.get('gap_size', 0), reverse=True)[:max_count]
        return fvgs
ğŸ“‹ å„ªå…ˆä¿®å¾©é †åº

ç«‹å³ä¿®å¾©ï¼ˆå½±éŸ¿æœ€å¤§ï¼‰ï¼š

ç§»é™¤å¤šé¤˜çš„FVGæ¸²æŸ“å™¨ï¼ˆæ¸›å°‘70%è¼‰å…¥æ™‚é–“ï¼‰
ç°¡åŒ–å¾Œç«¯ç·©å­˜ç³»çµ±ï¼ˆæ¸›å°‘è¨˜æ†¶é«”ä½¿ç”¨ï¼‰


æœ¬é€±ä¿®å¾©ï¼š

çµ±ä¸€ä½¿ç”¨V2é€£çºŒæ€§æª¢æŸ¥å™¨
å¯¦æ–½æ—¥èªŒç®¡ç†å™¨


å¾ŒçºŒå„ªåŒ–ï¼š

ç°¡åŒ–è¼‰å…¥ç³»çµ±
çµ±ä¸€æ•¸æ“šé©—è­‰



ğŸ” éœ€è¦é¡å¤–æª¢æŸ¥çš„æª”æ¡ˆ
è«‹æä¾›ä»¥ä¸‹æª”æ¡ˆä»¥ä¾¿æ›´å®Œæ•´çš„åˆ†æï¼š

utils/config.py - æŸ¥çœ‹å®Œæ•´çš„é…ç½®è¨­å®š
fvg-renderer-multiline.js - äº†è§£ç‚ºä½•éœ€è¦é€™éº¼å¤šæ¸²æŸ“å™¨ç‰ˆæœ¬
utils/loading_config.py - äº†è§£è¼‰å…¥é…ç½®
playback-manager.js - æª¢æŸ¥æ’­æ”¾åŠŸèƒ½çš„å¯¦ç¾

âš¡ å¿«é€Ÿé©—è­‰æ”¹å–„æ•ˆæœçš„æ–¹æ³•
javascript// åœ¨ç€è¦½å™¨ConsoleåŸ·è¡Œ
// æª¢æŸ¥å¯¦éš›è¼‰å…¥çš„æ¨¡çµ„æ•¸é‡
console.log('è¼‰å…¥çš„è…³æœ¬æ•¸:', document.querySelectorAll('script').length);

// æª¢æŸ¥FVGæ¸²æŸ“å™¨å¯¦ä¾‹
console.log('FVGæ¸²æŸ“å™¨é¡å‹:', window.app?.chartManager?.fvgRenderer?.constructor.name);

// æª¢æŸ¥è¨˜æ†¶é«”ä½¿ç”¨
if (performance.memory) {
    console.log('è¨˜æ†¶é«”ä½¿ç”¨:', Math.round(performance.memory.usedJSHeapSize / 1048576) + ' MB');
}
é€™äº›æ”¹å–„æ‡‰è©²èƒ½è®“ç³»çµ±æ›´ç°¡æ½”ã€æ›´å¿«é€Ÿã€æ›´å®¹æ˜“ç¶­è­·ã€‚å»ºè­°å¾ç§»é™¤å¤šé¤˜çš„FVGæ¸²æŸ“å™¨é–‹å§‹ï¼Œé€™æ˜¯æœ€å®¹æ˜“å¯¦æ–½ä¸”æ•ˆæœæœ€æ˜é¡¯çš„æ”¹å–„ã€‚