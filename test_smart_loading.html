<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½è¼‰å…¥æ¨¡å¼æ¸¬è©¦</title>
    <style>
        body { font-family: monospace; margin: 20px; background: #1a1a1a; color: #fff; }
        .test-container { max-width: 800px; margin: 0 auto; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #333; border-radius: 8px; }
        .test-section h3 { color: #4CAF50; margin-top: 0; }
        .mode-info { background: #333; padding: 10px; border-radius: 4px; margin: 10px 0; }
        .mode-switcher { margin: 15px 0; }
        .mode-switcher button { 
            margin: 0 5px; padding: 8px 16px; background: #333; color: #fff; 
            border: 1px solid #555; border-radius: 4px; cursor: pointer; 
        }
        .mode-switcher button.active { background: #4CAF50; }
        .renderer-list { background: #2a2a2a; padding: 10px; border-radius: 4px; margin: 10px 0; }
        .log { background: #000; padding: 10px; border-radius: 4px; height: 200px; overflow-y: auto; font-size: 12px; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª æ™ºèƒ½è¼‰å…¥æ¨¡å¼æ¸¬è©¦</h1>
        
        <div class="test-section">
            <h3>ç•¶å‰æ¨¡å¼æª¢æ¸¬</h3>
            <div class="mode-info">
                ç•¶å‰æ¨¡å¼: <span id="current-mode">æª¢æ¸¬ä¸­...</span>
            </div>
            <div class="mode-info">
                URLåƒæ•¸: <span id="url-params">æª¢æ¸¬ä¸­...</span>
            </div>
            <div class="mode-info">
                æœ¬åœ°å­˜å„²: <span id="local-storage">æª¢æ¸¬ä¸­...</span>
            </div>
        </div>
        
        <div class="test-section">
            <h3>æ¨¡å¼åˆ‡æ›æ¸¬è©¦</h3>
            <div class="mode-switcher">
                <button onclick="testSwitchMode('production')" id="btn-production">ç”Ÿç”¢æ¨¡å¼</button>
                <button onclick="testSwitchMode('debug')" id="btn-debug">èª¿è©¦æ¨¡å¼</button>
                <button onclick="testSwitchMode('development')" id="btn-development">é–‹ç™¼æ¨¡å¼</button>
            </div>
        </div>
        
        <div class="test-section">
            <h3>æ¸²æŸ“å™¨é¸æ“‡æ¸¬è©¦</h3>
            <div class="renderer-list" id="renderer-list">è¼‰å…¥ä¸­...</div>
        </div>
        
        <div class="test-section">
            <h3>æ¸¬è©¦æ—¥èªŒ</h3>
            <div class="log" id="test-log"></div>
        </div>
    </div>

    <script>
        // è¤‡è£½V2ä¸­çš„æª¢æ¸¬é‚è¼¯
        function detectLoadingMode() {
            const urlParams = new URLSearchParams(window.location.search);
            const urlMode = urlParams.get('mode');
            
            if (urlMode === 'debug') return 'debug';
            if (urlMode === 'dev' || urlMode === 'development') return 'development';
            if (urlMode === 'production') return 'production';
            
            const savedMode = localStorage.getItem('smartLoadingMode');
            if (savedMode && ['production', 'debug', 'development'].includes(savedMode)) {
                return savedMode;
            }
            
            return 'production';
        }
        
        // è¤‡è£½V2ä¸­çš„æ¸²æŸ“å™¨é¸æ“‡é‚è¼¯
        function getFVGRenderersForMode(mode) {
            const rendererConfigs = {
                production: {
                    description: 'ç”Ÿç”¢æ¨¡å¼ - æœ€ä½³æ€§èƒ½',
                    renderers: [
                        'fvg-renderer-optimized.js'
                    ]
                },
                debug: {
                    description: 'èª¿è©¦æ¨¡å¼ - åŒ…å«èª¿è©¦å·¥å…·',
                    renderers: [
                        'fvg-renderer-optimized.js',
                        'fvg-renderer-ultra-minimal.js',
                        'fvg-renderer-safe.js'
                    ]
                },
                development: {
                    description: 'é–‹ç™¼æ¨¡å¼ - å®Œæ•´åŠŸèƒ½',
                    renderers: [
                        'fvg-renderer-optimized.js',
                        'fvg-renderer-multiline.js',
                        'fvg-renderer-ultra-minimal.js',
                        'fvg-renderer-safe.js',
                        'fvg-renderer-fixed.js',
                        'fvg-renderer-minimal.js'
                    ]
                }
            };
            
            return rendererConfigs[mode] || rendererConfigs.production;
        }
        
        function log(message) {
            const logElement = document.getElementById('test-log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.innerHTML += `[${timestamp}] ${message}<br>`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(message);
        }
        
        function updateUI() {
            const mode = detectLoadingMode();
            const urlParams = new URLSearchParams(window.location.search);
            const savedMode = localStorage.getItem('smartLoadingMode');
            
            // æ›´æ–°é¡¯ç¤º
            document.getElementById('current-mode').textContent = mode;
            document.getElementById('url-params').textContent = urlParams.get('mode') || 'ç„¡';
            document.getElementById('local-storage').textContent = savedMode || 'ç„¡';
            
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            document.querySelectorAll('.mode-switcher button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`btn-${mode}`).classList.add('active');
            
            // æ›´æ–°æ¸²æŸ“å™¨åˆ—è¡¨
            const rendererConfig = getFVGRenderersForMode(mode);
            document.getElementById('renderer-list').innerHTML = `
                <strong>${rendererConfig.description}</strong><br>
                æ¸²æŸ“å™¨æ•¸é‡: ${rendererConfig.renderers.length}<br>
                <div style="margin-top: 8px;">
                    ${rendererConfig.renderers.map(r => `â€¢ ${r}`).join('<br>')}
                </div>
            `;
            
            log(`ğŸ¯ æ¨¡å¼æ›´æ–°: ${mode} (${rendererConfig.renderers.length} å€‹æ¸²æŸ“å™¨)`);
        }
        
        function testSwitchMode(mode) {
            log(`ğŸ”„ æ¸¬è©¦åˆ‡æ›åˆ°: ${mode}`);
            
            localStorage.setItem('smartLoadingMode', mode);
            const url = new URL(window.location);
            url.searchParams.set('mode', mode);
            
            log(`ğŸ’¾ ä¿å­˜åˆ°localStorage: ${mode}`);
            log(`ğŸ”— æ›´æ–°URL: ${url.toString()}`);
            
            // ä¸é‡æ–°è¼‰å…¥é é¢ï¼Œåªæ›´æ–°UIä¾†æ¸¬è©¦
            setTimeout(updateUI, 100);
        }
        
        // å¯¦éš›åˆ‡æ›æ¨¡å¼ (é‡æ–°è¼‰å…¥é é¢)
        function switchMode(mode) {
            localStorage.setItem('smartLoadingMode', mode);
            const url = new URL(window.location);
            url.searchParams.set('mode', mode);
            window.location = url.toString();
        }
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸš€ æ™ºèƒ½è¼‰å…¥æ¨¡å¼æ¸¬è©¦é–‹å§‹');
            updateUI();
        });
        
        // æ·»åŠ å¯¦éš›åˆ‡æ›æŒ‰éˆ•
        setTimeout(() => {
            const container = document.querySelector('.test-section:nth-child(3)');
            container.innerHTML += `
                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #444;">
                    <strong>å¯¦éš›åˆ‡æ› (é‡æ–°è¼‰å…¥é é¢):</strong><br>
                    <button onclick="switchMode('production')" style="margin: 5px; padding: 8px 16px; background: #444; color: #fff; border: 1px solid #666; border-radius: 4px; cursor: pointer;">åˆ‡æ›åˆ°ç”Ÿç”¢æ¨¡å¼</button>
                    <button onclick="switchMode('debug')" style="margin: 5px; padding: 8px 16px; background: #444; color: #fff; border: 1px solid #666; border-radius: 4px; cursor: pointer;">åˆ‡æ›åˆ°èª¿è©¦æ¨¡å¼</button>
                    <button onclick="switchMode('development')" style="margin: 5px; padding: 8px 16px; background: #444; color: #fff; border: 1px solid #666; border-radius: 4px; cursor: pointer;">åˆ‡æ›åˆ°é–‹ç™¼æ¨¡å¼</button>
                </div>
            `;
        }, 500);
    </script>
</body>
</html>